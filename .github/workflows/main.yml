name: Device Tree Generator Only (YT-X705X)

on:
  workflow_dispatch:

jobs:
  generate_tree:
    name: Generate and Upload Device Tree
    runs-on: ubuntu-22.04

    steps:
      - name: 1. Checkout Repository (Get boot.img)
        uses: actions/checkout@v4
        
      - name: 2. Set up Environment and Install twrpdtgen
        run: |
          # Install Python, git, and the generator utility
          sudo apt update
          sudo apt install -y git python3 python3-pip
          pip3 install twrpdtgen

      - name: 3. ðŸŒ³ Generate Device Tree from boot.img (ABSOLUTE MINIMUM)
        run: |
          echo "Executing twrpdtgen to generate device tree from boot.img..."
          # Command format: twrpdtgen [image]. Removing all flags and positional arguments.
          python3 -m twrpdtgen boot.img
          
          # Check if files were created in the expected location:
          echo "Listing generated files (looking for device/lenovo/YT-X705X):"
          ls -R device/

      - name: 4. Upload Device Tree as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Generated-Device-Tree-Artifact
          # We upload the entire 'device' folder, as the location might be inferred by the tool.
          path: device/
          retention-days: 1
